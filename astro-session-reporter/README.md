# Astro Session Reporter 🔭📝

This project contains a collection of Python scripts designed to analyze and report on data quality and events from an astrophotography observing session. It primarily uses FITS file headers and log files generated by acquisition software (like N.I.N.A.) and guiding software (PHD2).

## Functionality 🛠️

This project includes the following main analysis scripts:

1.  **`phd2_error_anaylsis.py`**: 
    *   Correlates image exposure times (from Autorun logs and FITS headers) with PHD2 guide log data.
    *   Calculates the Root Mean Square (RMS) guiding error (in arcseconds and microns) for RA, Dec, and Total, for each individual image exposure.
    *   Counts the number of "guide star lost" events during each exposure.
    *   Calculates and reports the overall guiding RMS for the entire session.
    *   Outputs results to the console and saves a detailed CSV file.

2.  **`altaz_stats_calculator.py`**:
    *   Scans a directory for FITS files.
    *   Parses the local time from the FITS filename (using a specific pattern like `YYYYMMDD-HHMMSS`).
    *   Reads RA and Dec coordinates from the FITS header.
    *   Uses the observer's location (defined in the script) and the timestamp to calculate the Altitude and Azimuth of the target for each image.
    *   Calculates basic image statistics (mean and standard deviation of pixel values).
    *   Outputs results to the console and saves a CSV file containing filename, timestamp, Alt/Az coordinates, and image statistics.

3.  **`autofocus_analysis.py`**:
    *   Acts as a comprehensive log parser for Autorun logs (likely from N.I.N.A.).
    *   Uses regular expressions to identify and extract various session events, including:
        *   Autofocus details (start, end, success/failure, position)
        *   Guiding events (start/stop, star loss, settling)
        *   Image exposures
        *   Plate solving results
        *   Meridian flips
        *   Mount tracking and slewing
        *   Target coordinates
        *   Wait states
    *   Categorizes these events and saves the data into multiple separate CSV files (one for each major event type, e.g., `autofocus_events.csv`, `guide_events.csv`).

4. **`run_all.py`**:
    * Runs all the analysis scripts in sequence in a clean environment
    * Takes configuration from environment variables or .env file
    * Features a rich, colorful terminal UI that shows progress and status
    * Handles errors gracefully, continuing to the next script if one fails
    * Can be run with `--debug` flag for additional diagnostic information

## Project Structure 📁

```
astro-session-reporter/
├── phd2_error_anaylsis.py     # Guiding performance analysis
├── altaz_stats_calculator.py  # Altitude/Azimuth calculation and basic image stats
├── autofocus_analysis.py      # Comprehensive session event log parser
├── run_all.py                 # Main script runner with rich terminal UI
├── utils/                     # Utility modules 
│   └── paths.py               # Path resolution and environment handling
└── README.md                  # This file
└── output/                    # Generated CSV reports and output files
```

## Configuration ⚙️

You can configure the analyzer using environment variables or a `.env` file in the project root. The following variables are available:

```
# Directory containing FITS files and log files (REQUIRED)
RAW_DIR="/path/to/your/imaging/session/data"

# Directory for output files (optional, defaults to RAW_DIR)
REPORTS_DIR="/path/to/output/directory"

# Observer Location (for altitude/azimuth calculations)
OBSERVER_LAT=45.5145       # Latitude in decimal degrees
OBSERVER_LON=-122.848      # Longitude in decimal degrees 
OBSERVER_HEIGHT=60         # Height in meters
```

## Setup and Usage 🚀

1.  **Prerequisites:**
    *   Python 3.x
    *   Required libraries: `astropy`, `numpy`, `python-dotenv`, `rich`
    ```bash
    # Assuming you are in the astro-scripts root directory
    python -m venv .venv
    source .venv/bin/activate # or .\.venv\Scripts\activate on Windows
    pip install astropy numpy python-dotenv rich pytz # zoneinfo is built-in for Python >= 3.9
    ```

2.  **Configuration:**
    *   Create a `.env` file in the project root or set environment variables as shown in the Configuration section
    *   Each script also contains user-configurable constants near the top that can be modified if needed

3.  **Run Analysis:**
    *   Navigate to the project root directory in your terminal
    *   To run all analyzers at once:
        ```bash
        python astro-session-reporter/run_all.py
        ```
    *   To run with debug information:
        ```bash 
        python astro-session-reporter/run_all.py --debug
        ```
    *   To run individual scripts:
        ```bash
        python astro-session-reporter/phd2_error_anaylsis.py
        python astro-session-reporter/altaz_stats_calculator.py
        python astro-session-reporter/autofocus_analysis.py
        ```

4.  **Output:**
    *   Check the terminal for summary information and processing logs.
    *   Find the generated CSV report files in the directory specified by `REPORTS_DIR` or in the session directory.

## Notes 📌

*   These scripts rely on specific formats and content within the log files and FITS headers. Adjustments to the parsing logic may be needed depending on your specific acquisition software versions and settings.
*   The `altaz_stats_calculator.py` assumes filenames contain a timestamp in `YYYYMMDD-HHMMSS` format and uses the timezone specified in the configuration. Modify if your setup differs.
*   The scripts are designed to be run from the project root directory, not from within the `astro-session-reporter` directory. 